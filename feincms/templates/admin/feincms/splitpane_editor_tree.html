{% extends "admin/base_site.html" %}

{% load i18n mptt_tags %}

{% block title %}{{ block.super }}{% endblock %}

{% block extrahead %}{{ block.super }}
<script type="text/javascript" src="../../jsi18n/"></script>

{% if FEINCMS_ADMIN_MEDIA_HOTLINKING %}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
{% else %}
<script type="text/javascript" src="{{ FEINCMS_ADMIN_MEDIA }}jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="{{ FEINCMS_ADMIN_MEDIA }}ui/jqueryui-custom-1.7.2.min.js"></script>
<link rel="stylesheet" type="text/css" href="{{ FEINCMS_ADMIN_MEDIA }}ui/jqueryui-custom-1.7.2.css" />
{% endif %}

<script type="text/javascript" src="{{ FEINCMS_ADMIN_MEDIA }}jquery.alerts.js"></script>
<script type="text/javascript" src="{{ FEINCMS_ADMIN_MEDIA }}jquery.json-1.3.js"></script>
<script type="text/javascript" src="{{ FEINCMS_ADMIN_MEDIA }}jquery.simple.tree.js"></script>
<script type="text/javascript" src="{{ FEINCMS_ADMIN_MEDIA }}jquery.contextmenu.r2.js"></script>
<script type="text/javascript">
{% include "admin/feincms/_messages.html" %}
</script>

<link rel="stylesheet" type="text/css" href="{{ FEINCMS_ADMIN_MEDIA }}style.css" />
<link rel="stylesheet" type="text/css" href="{{ FEINCMS_ADMIN_MEDIA }}jquery.simple.tree.css" />

<script type="text/javascript">
function frame_goto(location) {
    top.frames.frame_content.location.assign(top.location.pathname+location);
}

var simpleTreeCollection;
$(document).ready(function(){
    simpleTreeCollection = $('.simpleTree').simpleTree({
        autoclose: false,
        afterClick:function(node){
            frame_goto(node.attr('id').substr(4)+'/');
        },
        afterDblClick:function(node){
            //alert("text-"+$('span:first',node).text());
        },
        afterMove:function(destination, source, pos){
            $.post('.', {
                '__cmd': 'move_node',
                'destination': destination.attr('id').substr(4),
                'source': source.attr('id').substr(4),
                'position': pos
            }, function(data) {
                alert(data);
            });
        },
        afterAjax:function()
        {
            //alert('Loaded');
        },
        animate:true,
        docToFolderConvert:true,
        imagesBasePath: '{{ FEINCMS_ADMIN_MEDIA }}images/'
    });

    $('.simpleTree .root span').contextMenu('myMenu1', {
        bindings: {
            'add': function(trigger) { frame_goto('add/'); },
            'reload': function(trigger) { window.location.reload(); },
        }
    });
    $('.simpleTree ul li span').contextMenu('myMenu2', {
        bindings: {
            'edit': function(trigger) { frame_goto(trigger.parentNode.id.substr(4)+'/'); },
            'delete': function(trigger) { frame_goto(trigger.parentNode.id.substr(4)+'/delete/'); }
        }
    });
});
</script>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="../../" target="top">
    {% trans "Home" %}
  </a>
   &rsaquo; 
   <a href="../" target="top">
     {{ opts.app_label|capfirst }}
  </a>
  &rsaquo; 
  {{ opts.verbose_name_plural|capfirst }}
</div>
{% endblock %}

{% block content %}

<div class="contextMenu" id="myMenu1">
    <ul>
        <li id="add"><img src="{{ FEINCMS_ADMIN_MEDIA }}images/folder_add.png" /> Add {{ opts.verbose_name }}</li>
        <li id="reload"><img src="{{ FEINCMS_ADMIN_MEDIA }}images/arrow_refresh.png" /> Reload</li>
        {% comment %}
        <li id="edit"><img src="{{ FEINCMS_ADMIN_MEDIA }}images/folder_edit.png" /> Edit</li>
        <li id="delete"><img src="{{ FEINCMS_ADMIN_MEDIA }}images/folder_delete.png" /> Delete</li>
        {% endcomment %}
    </ul>
</div>
<div class="contextMenu" id="myMenu2">
    <ul>
        <li id="edit"><img src="{{ FEINCMS_ADMIN_MEDIA }}images/page_edit.png" /> Edit</li>
        <li id="delete"><img src="{{ FEINCMS_ADMIN_MEDIA }}images/page_delete.png" /> Delete</li>
    </ul>
</div>

<ul class="simpleTree">
<li class="root" id="item0"><span>{{ opts.verbose_name_plural|capfirst }}</span>
{% for item, structure in object_list|tree_info %}
    {% if structure.new_level %}<ul>{% else %}</li>{% endif %}
    <li id="item{{ item.id }}">
    <span>{{ item }}</span>
    {% for level in structure.closed_levels %}</li></ul>{% endfor %}
{% endfor %}
</li>
</ul>

{% endblock %}